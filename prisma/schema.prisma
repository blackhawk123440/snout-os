generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Rate {
  id        String    @id @default(uuid())
  service   String
  duration  Int
  baseRate  Float
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  @@unique([service, duration], name: "service_duration")
}

model Booking {
  id            String        @id @default(uuid())
  firstName     String
  lastName      String
  phone         String
  email         String
  address       String
  pickupAddress String?
  dropoffAddress String?
  service       String
  startAt       DateTime
  endAt         DateTime
  totalPrice    Float
  status        String        @default("pending")
  notes         String?
  stripePaymentLinkUrl String?
  tipLinkUrl    String?
  paymentStatus String        @default("unpaid")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  afterHours    Boolean       @default(false)
  holiday       Boolean       @default(false)
  quantity      Int           @default(1)
  pets          Pet[]
  sitter        Sitter?       @relation(fields: [sitterId], references: [id])
  sitterId      String?
  timeSlots     TimeSlot[]
  messages      Message[]
  reports       Report[]
  sitterPoolOffers SitterPoolOffer[]

  @@index([sitterId])
  @@index([status])
  @@index([createdAt])
}

model Pet {
  id         String   @id @default(uuid())
  name       String
  species    String
  breed      String?
  age        Int?
  notes      String?
  booking    Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId  String

  @@index([bookingId])
}

model TimeSlot {
  id        String   @id @default(uuid())
  startAt   DateTime
  endAt     DateTime
  duration  Int
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId String
  createdAt DateTime @default(now())

  @@index([bookingId])
}

model Sitter {
  id              String              @id @default(uuid())
  firstName       String
  lastName        String
  phone           String
  email           String
  active          Boolean             @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  bookings        Booking[]
  personalPhone   String?
  openphonePhone  String?
  phoneType       String?
  stripeAccountId String?
  sitterPoolOffers SitterPoolOffer[]

  @@index([active])
}

model SitterPoolOffer {
  id               String   @id @default(uuid())
  bookingId        String
  sitterId         String?
  sitterIds        String?
  message          String?
  expiresAt        DateTime
  status           String   @default("active")
  responses        String   @default("[]")
  acceptedSitterId String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  booking          Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  sitter           Sitter?  @relation(fields: [sitterId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([sitterId])
  @@index([status])
}

model Message {
  id        String   @id @default(uuid())
  direction String
  from      String
  to        String
  body      String
  status    String
  booking   Booking? @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId String?
  createdAt DateTime @default(now())

  @@index([bookingId])
  @@index([direction])
}

model Setting {
  id        String   @id @default(uuid())
  updatedAt DateTime @updatedAt
  key       String   @unique
  value     String
  category  String?
  label     String?
  createdAt DateTime @default(now())

  @@index([category])
}

model Report {
  id            String   @id @default(uuid())
  bookingId     String?
  booking       Booking? @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  content       String
  mediaUrls     String?
  visitStarted  DateTime?
  visitCompleted DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([bookingId])
}

model GoogleCalendarAccount {
  id           String   @id @default(uuid())
  email        String   @unique
  provider     String   @default("google")
  accessToken  String
  refreshToken String?
  expiresAt    DateTime?
  calendarId   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([email])
}

model SitterPoolOffer {
  id               String    @id @default(uuid())
  bookingId        String
  sitterIds        String
  message          String?
  expiresAt        DateTime
  status           String    @default("active")
  responses        String    @default("[]")
  acceptedSitterId String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  booking          Booking   @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([status])
}
