generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Rate {
  id        String    @id @default(uuid())
  service   String
  duration  Int
  baseRate  Float
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  @@unique([service, duration], name: "service_duration")
}

model Booking {
  id            String        @id @default(uuid())
  firstName     String
  lastName      String
  phone         String
  email         String
  address       String
  service       String
  startAt       DateTime
  endAt         DateTime
  totalPrice    Float
  status        String        @default("pending")
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  afterHours    Boolean       @default(false)
  holiday       Boolean       @default(false)
  quantity      Int           @default(1)
  pets          Pet[]
  sitter        Sitter?       @relation(fields: [sitterId], references: [id])
  sitterId      String?
  timeSlots     TimeSlot[]
  messages      Message[]
  sitterPoolOffers SitterPoolOffer[]

  @@index([sitterId])
  @@index([status])
  @@index([createdAt])
}

model Pet {
  id         String   @id @default(uuid())
  name       String
  species    String
  breed      String?
  age        Int?
  notes      String?
  booking    Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId  String

  @@index([bookingId])
}

model TimeSlot {
  id        String   @id @default(uuid())
  startAt   DateTime
  endAt     DateTime
  duration  Int
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId String
  createdAt DateTime @default(now())

  @@index([bookingId])
}

model Sitter {
  id              String              @id @default(uuid())
  firstName       String
  lastName        String
  phone           String
  email           String
  active          Boolean             @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  bookings        Booking[]
  personalPhone   String?
  openphonePhone  String?
  phoneType       String?
  sitterPoolOffers SitterPoolOffer[]

  @@index([active])
}

model SitterPoolOffer {
  id         String   @id @default(uuid())
  booking    Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId  String
  sitter     Sitter   @relation(fields: [sitterId], references: [id], onDelete: Cascade)
  sitterId   String
  sentAt     DateTime @default(now())
  respondedAt DateTime?
  response   String?
  status     String   @default("pending")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([bookingId])
  @@index([sitterId])
  @@index([status])
}

model Message {
  id        String   @id @default(uuid())
  direction String
  from      String
  to        String
  body      String
  status    String
  booking   Booking? @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId String?
  createdAt DateTime @default(now())

  @@index([bookingId])
  @@index([direction])
}

model Setting {
  id        String   @id @default(uuid())
  updatedAt DateTime @updatedAt
  key       String   @unique
  value     String
  category  String?
  label     String?
  createdAt DateTime @default(now())

  @@index([category])
}

model Report {
  id            String   @id @default(uuid())
  bookingId     String?
  clientName    String
  petName       String
  visitDate     DateTime
  photos        String?
  notes         String?
  activities    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([bookingId])
  @@index([visitDate])
}

model GoogleCalendarAccount {
  id           String   @id @default(uuid())
  email        String   @unique
  accessToken  String
  refreshToken String
  expiresAt    DateTime
  calendarId   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([email])
}
